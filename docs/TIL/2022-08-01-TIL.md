---
layout: post
title:  "2022-08-01 TIL"
date:   2022-08-01 14:29:06 +0900
categories: TIL
---

<span style="color:green"> Optional </span>
==========================================

JAVA 8 부터 추가된 NPE를 예방하기위해 null또는 값을 감싸는 Wrapper 클래스이다.

JAVA 8 이전에는 NPE를 예방하기위해서 if 조건절을 추가하여 NPE를 예방하였다. 

Optional은 메소드의 결과가 null 이 될수있고 null 에 의해 오류가 발생할 가능성이 높을때 반환값으로만 사용되어야한다. 그렇지않으면 성능저하는 유발함.

Ex)
```java
 if(car != null) {
    System.out.println(car.size());
 }
```

Optional<T> 은 null 값일수도있는 변수를 감싸주는 Wrapper 클래스이며, 제네릭으로 값의 타입을 지정해주어야한다.

여러가지 메소드를 통해서 value에 접근하기때문에 NPE가 발생하지않는다.

Optional 생성
-------------
```java
Optional<String> optional = Optional.of(value);
//value변수의 값이 null인 경우 NPE예외가 발생. 반드시 값이 있어야하는 경우에 사용하는 메소드이다.
```

```java
Optional<String> optional = Optional.ofNullable(value);
//value 변수가 null인경우 Optional.empty()가 리턴된다.
```

```java
Optional<String> optional = Optional.empty();
//빈 Optional 객체를 생성. 객체 자체는 있지만 내부에서 가리키는 참조가 없는 경우임. 미리생성되어있는 싱글톤 객체이다.
```

Optional 중간처리
----------------

- map()
------
-> Optional 객체의 값을 수정하여 다른값으로 변경하는 메서드이다.

Ex)
```java
Optional<String> op = Optional.of("abcd");
System.out.println(op.map(String::toUpperCase)); // Optional[ABCDE]
System.out.println(op); // Optional[abcde]
```

- filter()
----------
-> 원하는 값을 갖는 Optional 객체만 필터링할 수 있다.

```java
public Optional<Car> filterBrand(Car car) {
	// 객체의 `brand` 필드값이 "KIA" 인 경우
    return Optional.ofNullable(car)
        .filter(p -> p.getBrand().equals("KIA"));
}
```


Optional 값 리턴 메소드
----------------------

- isPresent()
-----------
-> 값이 존재하는지 여부만 판단

```java
Optional.of("TEST").isPresent(); //true
Optional.of("TEST").filter(v -> "Not Equals".equals(v)).isPresent(); //false
```


- ifPresent()
-----------
-> 람다식을 인자로 받아, 값이 존재할 떄 그 값에 람다식을 적용함. Optional 객체에 값이 없다면 실행x

```java
Optional.of("TEST").ifPresent(System.out::println); //TEST출력
Optional.ofNullable(null).ifPresent(System.out::println); //아무것도 출력x
```
- get()
-----
-> Optional 객체가 갖고있는 value를 꺼내옴. 값이 없다면 NoSuchElementException발생
```java
Optional.of("TEST").get(); //"TEST" 리턴
Optional.ofNullable(null).get(); //NoSuchElementException
```

- orElse()
--------
-> 중간처리 메소드들을 거치거나 혹은 원래 Optional 객체가 비어있으면 orElse()메소드에 지정된 값이 기본값으로 리턴됨
```java
Optional.of("XYZ").filter(v -> v.startsWith("AB")).orElse("Not AB"); //"Not AB" 리턴
```

- orElseGet()
-----------
-> 중간처리 메소드들을 거치거나 혹은 원래 Optionaol 객체가 비어있다면 orElseGet() 메소드의 인자로 입력되어있는 Supplier함수를 적용하여 객체를 얻어온다.
```java
Optional.of("XYZ").filter(v -> v.startsWith("AB")).orElseGet(() -> "Not AB"); //"Not AB" 리턴
```

- orElse()와 orElseGet의 차이점
----------------------------

<span style="color:red"> orElse() </span>
- 메소드의 인자를 항상 평가함. (Value가 메모리상에 존재한다고 가정함)
- Optional 내부 값이 null이건 말건 함수를 실행시켜 Value를 가져옴. 
- 즉, orElse()는 인자평가가 항상 발생해서 객체 생성의 비용이 크다.

<span style="color:red"> orElseGet() </span>
- Optional 객체가 null인 경우에만 Supplier함수를 실행함. 
- 따라서 객체 생성의 비용이 크다면 orElseGet()을 사용해야된다.

orElseThrow()
-------------
->Optional이 null인 경우 예외를 던질때 사용함

```java
Optional<String> op = Optional.of("hello");
return op.orElseThrow(() -> new Exception("null"));
```












